<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Auto-Response System</title>
    <style>
        /* Custom Dark Mode Colors */
        :root {
  /* Custom Dark Mode Variables */
  --dark-bg-primary: #181A20;
  --dark-bg-secondary: #23272F;
  --dark-bg-tertiary: #292D36;
  --dark-text-primary: #FFFFFF;
  --dark-text-secondary: #E4E6EB;
  --dark-accent-start: #667eea;
  --dark-accent-end: #764ba2;
  --dark-border: rgba(255, 255, 255, 0.1);
  --dark-card-border: rgba(255, 255, 255, 0.08);

  /* Primitive Color Tokens */
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-teal-800: rgba(41, 150, 161, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);

  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;

  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);

  --font-family-base: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
  --font-size-xs: 11px;
  --font-size-sm: 12px;
  --font-size-base: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-2xl: 20px;
  --font-size-3xl: 24px;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 550;
  --font-weight-bold: 600;

  --space-8: 8px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;
  --space-32: 32px;

  --radius-base: 8px;
  --radius-lg: 12px;
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
}

/* Dark Mode Theme */
[data-theme="dark"] {
  --color-background: var(--dark-bg-primary);
  --color-surface: var(--dark-bg-secondary);
  --color-text: var(--dark-text-secondary);
  --color-text-secondary: rgba(228, 230, 235, 0.7);
  --color-primary: var(--dark-accent-start);
  --color-primary-hover: var(--dark-accent-end);
  --color-border: var(--dark-border);
  --color-card-border: var(--dark-card-border);
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3), 0 1px 2px rgba(0, 0, 0, 0.2);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
}

[data-theme="dark"] .header-title,
[data-theme="dark"] h1,
[data-theme="dark"] h2,
[data-theme="dark"] h3,
[data-theme="dark"] .stat-number,
[data-theme="dark"] .email-from,
[data-theme="dark"] .modal-header h2 {
  color: var(--dark-text-primary);
}

[data-theme="dark"] .system-status {
  background: rgba(102, 126, 234, 0.15);
  color: var(--dark-accent-start);
}

[data-theme="dark"] .status-dot {
  background: var(--dark-accent-start);
}

[data-theme="dark"] .btn-icon {
  color: var(--dark-text-secondary);
}

[data-theme="dark"] .btn-icon:hover {
  color: var(--dark-text-primary);
}

[data-theme="dark"] .stats-card,
[data-theme="dark"] .email-history,
[data-theme="dark"] .email-card,
[data-theme="dark"] .modal-content {
  background: var(--dark-bg-secondary);
  border-color: var(--dark-card-border);
}

[data-theme="dark"] .email-card {
  background: var(--dark-bg-tertiary);
}

[data-theme="dark"] .email-card:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
}

[data-theme="dark"] .meta-item {
  background: rgba(102, 126, 234, 0.1);
}

[data-theme="dark"] .message-box {
  background: rgba(102, 126, 234, 0.1);
  border-left-color: var(--dark-accent-start);
}

[data-theme="dark"] .form-group input,
[data-theme="dark"] .form-group textarea {
  background: var(--dark-bg-tertiary);
  border-color: var(--dark-border);
  color: var(--dark-text-secondary);
}

[data-theme="dark"] .form-group input::placeholder,
[data-theme="dark"] .form-group textarea::placeholder {
  color: rgba(228, 230, 235, 0.5);
}

[data-theme="dark"] .form-group input:focus,
[data-theme="dark"] .form-group textarea:focus {
  border-color: var(--dark-accent-start);
}

[data-theme="dark"] .form-group input:disabled {
  background: rgba(255, 255, 255, 0.05);
}

[data-theme="dark"] .send-btn,
[data-theme="dark"] .followup-btn {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

[data-theme="dark"] .cancel-btn {
  background: rgba(255, 255, 255, 0.1);
  color: var(--dark-text-secondary);
}

[data-theme="dark"] .cancel-btn:hover {
  background: rgba(255, 255, 255, 0.15);
}

[data-theme="dark"] .email-feed::-webkit-scrollbar-thumb {
  background: var(--dark-card-border);
}

/* Light Mode (default styles remain as is) */

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-base);
            background: var(--color-background);
            color: var(--color-text);
            min-height: 100vh;
            line-height: 1.5;
        }

        /* Header Styles */
        .header {
            background: var(--color-surface);
            border-bottom: 1px solid var(--color-card-border);
            padding: var(--space-20) var(--space-32);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: var(--space-20);
        }

        .system-status {
            display: inline-flex;
            align-items: center;
            padding: var(--space-8) var(--space-16);
            border-radius: 20px;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            background: rgba(33, 128, 141, 0.1);
            color: var(--color-primary);
            gap: var(--space-8);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--color-primary);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .refreshing {
            animation: spin 1s linear infinite;
        }

        .btn-icon {
            background: none;
            border: none;
            font-size: var(--font-size-2xl);
            cursor: pointer;
            color: var(--color-text-secondary);
            transition: color 0.2s;
            padding: var(--space-8);
        }

        .btn-icon:hover {
            color: var(--color-text);
        }

        .theme-toggle {
            background: var(--color-secondary);
            border: 1px solid var(--color-border);
            border-radius: 20px;
            padding: var(--space-8) var(--space-16);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: var(--space-8);
            font-size: var(--font-size-base);
            color: var(--color-text);
            transition: all 0.3s;
            font-weight: var(--font-weight-medium);
        }

        .theme-toggle:hover {
            background: var(--color-secondary-hover);
            transform: translateY(-1px);
        }

        [data-theme="dark"] .theme-toggle {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--dark-border);
        }

        [data-theme="dark"] .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .theme-icon {
            font-size: 18px;
            transition: transform 0.3s;
        }

        .theme-toggle:hover .theme-icon {
            transform: rotate(20deg);
        }

        /* Main Content */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-32);
            display: grid;
            grid-template-columns: 30% 70%;
            gap: var(--space-32);
        }

        /* Stats Card */
        .stats-card {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            padding: var(--space-24);
            box-shadow: var(--shadow-sm);
        }

        .stats-card h2 {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-24);
            color: var(--color-text);
        }

        .stat-item {
            margin-bottom: var(--space-20);
            padding-bottom: var(--space-20);
            border-bottom: 1px solid var(--color-card-border);
        }

        .stat-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .stat-item-header {
            display: flex;
            align-items: center;
            gap: var(--space-12);
            margin-bottom: var(--space-8);
        }

        .stat-icon {
            font-size: var(--font-size-2xl);
        }

        .stat-label {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            font-weight: var(--font-weight-medium);
        }

        .stat-number {
            font-size: 32px;
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
        }

        /* Email History Section */
        .email-history {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            padding: var(--space-24);
            box-shadow: var(--shadow-sm);
        }

        .email-history h2 {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-20);
            color: var(--color-text);
        }

        .email-feed {
            max-height: calc(100vh - 250px);
            overflow-y: auto;
            padding-right: var(--space-8);
        }

        .email-feed::-webkit-scrollbar {
            width: 6px;
        }

        .email-feed::-webkit-scrollbar-track {
            background: transparent;
        }

        .email-feed::-webkit-scrollbar-thumb {
            background: var(--color-card-border);
            border-radius: 3px;
        }

        .email-card {
            background: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: var(--radius-base);
            padding: var(--space-16);
            margin-bottom: var(--space-16);
            cursor: pointer;
            transition: all 0.2s;
            border-left: 4px solid;
        }

        .email-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .email-card.support { border-left-color: #3498db; }
        .email-card.sales { border-left-color: #27ae60; }
        .email-card.billing { border-left-color: #f39c12; }
        .email-card.product { border-left-color: #9b59b6; }
        .email-card.general { border-left-color: #95a5a6; }

        .email-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-12);
        }

        .email-timestamp {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
            font-weight: var(--font-weight-medium);
        }

        .email-from {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin-bottom: var(--space-8);
        }

        .email-subject {
            font-size: var(--font-size-base);
            color: var(--color-text);
            margin-bottom: var(--space-12);
            line-height: 1.4;
        }

        .email-footer {
            display: flex;
            align-items: center;
            gap: var(--space-12);
            flex-wrap: wrap;
        }

        .category-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-semibold);
            color: var(--color-surface);
        }

        .category-badge.support { background: #3498db; }
        .category-badge.sales { background: #27ae60; }
        .category-badge.billing { background: #f39c12; }
        .category-badge.product { background: #9b59b6; }
        .category-badge.general { background: #95a5a6; }

        .status-text {
            font-size: var(--font-size-xs);
            color: var(--color-primary);
            font-weight: var(--font-weight-medium);
        }

        .response-time {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            padding: var(--space-24);
            border-bottom: 1px solid var(--color-card-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            color: var(--color-text);
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--color-text-secondary);
            transition: color 0.2s;
        }

        .btn-close:hover {
            color: var(--color-text);
        }

        .modal-body {
            padding: var(--space-24);
        }

        .modal-section {
            margin-bottom: var(--space-24);
        }

        .modal-section h3 {
            color: var(--color-text);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-12);
        }

        .modal-section p {
            color: var(--color-text);
            line-height: 1.6;
            margin: 0;
        }

        .modal-meta {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-16);
            margin-bottom: var(--space-24);
        }

        .meta-item {
            background: rgba(var(--color-teal-500-rgb), 0.05);
            padding: var(--space-12);
            border-radius: var(--radius-base);
        }

        .meta-label {
            font-size: var(--font-size-xs);
            color: var(--color-text-secondary);
            margin-bottom: 4px;
        }

        .meta-value {
            color: var(--color-text);
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-size-sm);
        }

        .message-box {
            background: rgba(var(--color-teal-500-rgb), 0.05);
            padding: var(--space-16);
            border-radius: var(--radius-base);
            border-left: 4px solid var(--color-primary);
        }

        /* Follow-up Modal Styles */
        .followup-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1100;
            align-items: center;
            justify-content: center;
        }

        .followup-modal.active {
            display: flex;
        }

        .followup-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            font-size: var(--font-size-sm);
        }

        .form-group input,
        .form-group textarea {
            padding: 12px;
            border: 2px solid var(--color-border);
            border-radius: var(--radius-base);
            font-family: var(--font-family-base);
            font-size: var(--font-size-base);
            background: var(--color-surface);
            color: var(--color-text);
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group input:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background: rgba(var(--color-brown-600-rgb), 0.05);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 150px;
        }

        .followup-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: var(--space-16);
        }

        .send-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: var(--radius-base);
            cursor: pointer;
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-size-base);
            transition: all 0.2s;
        }

        .send-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .cancel-btn {
            padding: 12px 24px;
            background: var(--color-secondary);
            color: var(--color-text);
            border: none;
            border-radius: var(--radius-base);
            cursor: pointer;
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-base);
            transition: all 0.2s;
        }

        .cancel-btn:hover {
            background: var(--color-secondary-hover);
        }

        .followup-btn {
            width: 100%;
            padding: 14px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: var(--radius-base);
            cursor: pointer;
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-size-base);
            margin-top: var(--space-16);
            transition: all 0.2s;
        }

        .followup-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 80px;
            right: var(--space-32);
            padding: var(--space-16) var(--space-24);
            border-radius: var(--radius-base);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-medium);
            box-shadow: var(--shadow-lg);
            z-index: 2000;
            animation: slideIn 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: var(--space-12);
        }

        .notification.success {
            background: rgba(33, 128, 141, 0.15);
            color: var(--color-primary);
            border: 1px solid var(--color-primary);
        }

        .notification.error {
            background: rgba(192, 21, 47, 0.15);
            color: var(--color-error);
            border: 1px solid var(--color-error);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }



        /* Responsive Design */
        @media (max-width: 968px) {
            .main-container {
                grid-template-columns: 1fr;
                padding: var(--space-16);
            }

            .header-container {
                flex-direction: column;
                gap: var(--space-16);
                align-items: flex-start;
            }

            .header-right {
                width: 100%;
                justify-content: space-between;
            }

            .modal-meta {
                grid-template-columns: 1fr;
            }

            .email-feed {
                max-height: 500px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <h1 class="header-title">üìß Email Auto-Response System</h1>
            <div class="header-right">
                <div class="system-status">
                    <span class="status-dot"></span>
                    <span>Active</span>
                </div>
                <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="Toggle theme">
                    <span class="theme-icon" id="themeIcon">üåô</span>
                    <span id="themeText">Dark</span>
                </button>
                <button class="btn-icon" id="refreshBtn" title="Refresh" onclick="manualRefresh()">üîÑ</button>
                <button class="btn-icon" title="Settings">‚öôÔ∏è</button>
            </div>
        </div>
    </header>

    <!-- Setup Banner (shown when backend not configured) -->
    <div id="setupBanner" style="display: none; background: rgba(230, 129, 97, 0.15); border: 1px solid rgba(168, 75, 47, 0.3); padding: var(--space-16) var(--space-32); text-align: center; color: var(--color-text); font-size: var(--font-size-sm);">
        ‚ö†Ô∏è <strong>Using demo data.</strong> Configure <code>SCRIPT_URL</code> in the JavaScript to connect to your Google Apps Script backend.
    </div>

    <!-- Error Banner -->
    <div id="errorBanner" style="display: none; background: rgba(192, 21, 47, 0.15); border: 1px solid rgba(192, 21, 47, 0.3); padding: var(--space-16) var(--space-32); text-align: center; color: var(--color-error); font-size: var(--font-size-sm);">
        <span id="errorMessage"></span>
        <button onclick="retryFetch()" style="margin-left: var(--space-16); padding: var(--space-8) var(--space-16); background: var(--color-error); color: white; border: none; border-radius: var(--radius-base); cursor: pointer; font-size: var(--font-size-sm);">Retry</button>
    </div>

    <!-- Loading Indicator -->
    <div id="loadingIndicator" style="display: none; text-align: center; padding: var(--space-24); color: var(--color-text-secondary); font-size: var(--font-size-sm);">
        <div style="animation: spin 1s linear infinite; display: inline-block; font-size: 24px;">‚è≥</div>
        <div style="margin-top: var(--space-8);">Loading data...</div>
    </div>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Left Column: Stats Card -->
        <div class="stats-card">
            <h2>Quick Stats</h2>
            <div class="stat-item">
                <div class="stat-item-header">
                    <span class="stat-icon">üì¨</span>
                    <span class="stat-label">Total Emails Today</span>
                </div>
                <div class="stat-number" id="statTotal">--</div>
            </div>
            <div class="stat-item">
                <div class="stat-item-header">
                    <span class="stat-icon">‚úÖ</span>
                    <span class="stat-label">Auto-Responded</span>
                </div>
                <div class="stat-number" id="statResponded">--</div>
            </div>
            <div class="stat-item">
                <div class="stat-item-header">
                    <span class="stat-icon">‚ö°</span>
                    <span class="stat-label">Average Response Time</span>
                </div>
                <div class="stat-number" id="statAvgTime" style="font-size: 24px;">--</div>
            </div>
            <div class="stat-item">
                <div class="stat-item-header">
                    <span class="stat-icon">üìä</span>
                    <span class="stat-label">Success Rate</span>
                </div>
                <div class="stat-number" id="statSuccessRate">--</div>
            </div>
        </div>

        <!-- Right Column: Email History -->
        <div class="email-history">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-20);">
                <h2 style="margin: 0;">Recent Auto-Responses</h2>
                <span id="lastRefresh" style="font-size: var(--font-size-xs); color: var(--color-text-secondary);"></span>
            </div>
            <div class="email-feed" id="emailFeed"></div>
        </div>
    </div>

    <!-- Email Details Modal -->
    <div class="modal" id="emailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Email Details</h2>
                <button class="btn-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <!-- Follow-up Email Modal -->
    <div class="followup-modal" id="followupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚úâÔ∏è Send Follow-up Email</h2>
                <button class="btn-close" onclick="closeFollowUpForm()">&times;</button>
            </div>
            <div class="modal-body">
                <form class="followup-form" id="followupForm" onsubmit="handleFollowUpSubmit(event)">
                    <div class="form-group">
                        <label for="followupTo">To:</label>
                        <input type="email" id="followupTo" name="to" required disabled>
                    </div>
                    <div class="form-group">
                        <label for="followupSubject">Subject:</label>
                        <input type="text" id="followupSubject" name="subject" required>
                    </div>
                    <div class="form-group">
                        <label for="followupMessage">Message:</label>
                        <textarea id="followupMessage" name="message" rows="8" placeholder="Write your follow-up message here..." required></textarea>
                    </div>
                    <div class="followup-actions">
                        <button type="button" class="cancel-btn" onclick="closeFollowUpForm()">Cancel</button>
                        <button type="submit" class="send-btn" id="sendFollowUpBtn">Send Email</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        /**
         * üîµ GOOGLE APPS SCRIPT BACKEND INTEGRATION
         * 
         * SETUP INSTRUCTIONS:
         * 1. Deploy your Google Apps Script (email_automation_backend.gs) as a Web App
         * 2. Copy the Web App URL (looks like: https://script.google.com/macros/s/AKfycby.../exec)
         * 3. Replace SCRIPT_URL below with your actual deployment URL
         * 4. That's it! Dashboard will automatically fetch real data from Gmail
         * 
         * FALLBACK: If SCRIPT_URL is not configured, demo data will be used for preview
         */
        
        // üîµ BACKEND CONFIGURATION - Replace with your Google Apps Script Web App URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyD66_BK8koT_x2T3rS3idFTcyQ8rS3SiPyKEyP7pZUeP3ceZQKQdKhS7MXQzayqfc/exec';
        // Example: 'https://script.google.com/macros/s/AKfycby.../exec'
        
        // Check if backend is configured
        const isBackendConfigured = SCRIPT_URL !== 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE' && SCRIPT_URL.startsWith('https://');
        
        // Global state
        let currentStats = null;
        let currentEmails = [];
        let isLoading = false;
        let lastRefreshTime = null;
        let currentTheme = 'dark'; // Default to dark mode
        
        // Demo/Fallback email data
        const emailData = [
            {
                timestamp: "2 minutes ago",
                from: "john.smith@email.com",
                subject: "Help with password reset",
                category: "Support",
                response_time: "45 seconds",
                customer_message: "Hi, I forgot my password and can't log into my account. Can you help me reset it? I've tried the forgot password link but didn't receive an email.",
                auto_response: "Thank you for contacting our support team! To reset your password, please visit our password reset page and follow the instructions. You'll receive an email with a reset link within a few minutes. If you need further assistance, please don't hesitate to reach out."
            },
            {
                timestamp: "8 minutes ago",
                from: "sarah.jones@company.com",
                subject: "Enterprise pricing information",
                category: "Sales",
                response_time: "1 minute",
                customer_message: "Hello, I'm interested in your enterprise pricing plan for my company of 50+ employees. Can you provide details and a custom quote?",
                auto_response: "Thank you for your interest in our Enterprise plan! Our team specializes in custom solutions for businesses. I've forwarded your inquiry to our sales team, and they will contact you within 24 hours with detailed pricing and features."
            },
            {
                timestamp: "15 minutes ago",
                from: "mike.wilson@email.com",
                subject: "Invoice #12345 question",
                category: "Billing",
                response_time: "2 minutes",
                customer_message: "I received invoice #12345 but noticed the amount seems higher than expected. Can you help me understand the charges?",
                auto_response: "Thank you for contacting us regarding your billing inquiry. Our finance team has been notified and will review your account immediately. A billing specialist will respond within 12 hours with a detailed breakdown."
            },
            {
                timestamp: "23 minutes ago",
                from: "emma.chen@email.com",
                subject: "API documentation access",
                category: "Product",
                response_time: "1 minute",
                customer_message: "Where can I find the complete API documentation? I'm a developer looking to integrate your service.",
                auto_response: "Our complete API documentation is available at docs.example.com/api. You'll find guides, code examples, and API references. For API support, join our developer community. Happy coding!"
            },
            {
                timestamp: "32 minutes ago",
                from: "david.lee@email.com",
                subject: "General inquiry about features",
                category: "General",
                response_time: "1 minute",
                customer_message: "Can you tell me more about the features included in the basic plan? I'm considering signing up.",
                auto_response: "Thank you for your interest! Our Basic plan includes: Cloud storage, Team collaboration, Mobile access, 24/7 support, and Regular updates. Visit our pricing page for a complete feature comparison."
            },
            {
                timestamp: "47 minutes ago",
                from: "lisa.brown@email.com",
                subject: "Unable to upload files",
                category: "Support",
                response_time: "3 minutes",
                customer_message: "I'm having trouble uploading files to your platform. It keeps giving me an error message. Please help!",
                auto_response: "We're sorry you're experiencing technical difficulties. Our support team has been notified. In the meantime, please try: 1) Clearing browser cache, 2) Using different browser, 3) Checking file size (max 10MB)."
            },
            {
                timestamp: "1 hour ago",
                from: "robert.taylor@business.com",
                subject: "Bulk order for 50+ licenses",
                category: "Sales",
                response_time: "2 minutes",
                customer_message: "We're looking to purchase 50+ licenses for our team. What kind of pricing can you offer for bulk orders?",
                auto_response: "Thank you for considering us for your team! For bulk orders of 50+ licenses, we offer special enterprise pricing and dedicated support. Our sales team will contact you within 12 hours."
            },
            {
                timestamp: "1 hour ago",
                from: "amanda.white@email.com",
                subject: "Refund request",
                category: "Billing",
                response_time: "2 minutes",
                customer_message: "I'd like to request a refund for my recent purchase. It doesn't meet my needs as expected.",
                auto_response: "We're sorry to hear our service didn't meet your expectations. Our billing team will review your refund request and respond within 24 hours with the next steps."
            },
            {
                timestamp: "2 hours ago",
                from: "james.anderson@email.com",
                subject: "Integration with Slack",
                category: "Product",
                response_time: "1 minute",
                customer_message: "Does your platform integrate with Slack? We use it heavily for team communication.",
                auto_response: "Yes! We offer native integration with Slack, plus 50+ other popular tools. You can set up integrations from your Dashboard > Integrations. Check our full integration list on our website."
            },
            {
                timestamp: "2 hours ago",
                from: "olivia.garcia@email.com",
                subject: "Student discount availability",
                category: "Sales",
                response_time: "45 seconds",
                customer_message: "I'm a college student interested in your product. Do you offer student discounts?",
                auto_response: "Yes! We offer a 20% student discount on all our plans. Please verify your student status at our education page and you'll receive a discount code via email within 24 hours."
            },
            {
                timestamp: "3 hours ago",
                from: "kevin.martinez@email.com",
                subject: "Cancel subscription",
                category: "Billing",
                response_time: "2 minutes",
                customer_message: "I'd like to cancel my subscription. How do I proceed?",
                auto_response: "We're sorry to see you go! You can cancel your subscription anytime from Account Settings > Billing > Cancel Subscription. Your access will continue until the end of your billing period."
            },
            {
                timestamp: "3 hours ago",
                from: "maria.lopez@email.com",
                subject: "Two-factor authentication setup",
                category: "Support",
                response_time: "1 minute",
                customer_message: "How do I enable two-factor authentication on my account for better security?",
                auto_response: "Great security practice! You can enable 2FA from Settings > Security > Two-Factor Authentication. Follow the on-screen instructions to set it up. Our support team is here if you need assistance."
            }
        ];

        // ============================
        // üîµ BACKEND API FUNCTIONS
        // ============================
        
        /**
         * Fetch statistics from Google Apps Script backend
         */
        async function fetchStatistics() {
            if (!isBackendConfigured) {
                // Use demo data
                updateStatistics({
                    totalEmails: 47,
                    autoResponded: 42,
                    avgResponseTime: '< 2 minutes',
                    successRate: 89
                });
                return;
            }
            
            try {
                const response = await fetch(`${SCRIPT_URL}?action=getStats`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.stats) {
                    currentStats = data.stats;
                    updateStatistics(data.stats);
                    hideError();
                } else {
                    throw new Error(data.error || 'Invalid response format');
                }
            } catch (error) {
                console.error('Error fetching statistics:', error);
                showError(`Failed to load statistics: ${error.message}`);
                // Fallback to demo data on error
                if (!currentStats) {
                    updateStatistics({
                        totalEmails: 47,
                        autoResponded: 42,
                        avgResponseTime: '< 2 minutes',
                        successRate: 89
                    });
                }
            }
        }
        
        /**
         * Fetch emails from Google Apps Script backend
         */
        async function fetchEmails() {
            if (!isBackendConfigured) {
                // Use demo data
                displayEmails(convertDemoDataToAPIFormat(emailData));
                return;
            }
            
            try {
                const response = await fetch(`${SCRIPT_URL}?action=getEmails`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.emails) {
                    currentEmails = data.emails;
                    displayEmails(data.emails);
                    hideError();
                } else {
                    throw new Error(data.error || 'Invalid response format');
                }
            } catch (error) {
                console.error('Error fetching emails:', error);
                showError(`Failed to load emails: ${error.message}`);
                // Fallback to demo data on error
                if (currentEmails.length === 0) {
                    displayEmails(convertDemoDataToAPIFormat(emailData));
                }
            }
        }
        
        /**
         * Convert demo data format to API format
         */
        function convertDemoDataToAPIFormat(demoData) {
            return demoData.map(email => ({
                timestamp: getTimestampFromRelative(email.timestamp),
                from: email.from,
                subject: email.subject,
                inquiryType: email.category,
                status: 'Auto-Responded',
                responseTime: email.response_time,
                customerMessage: email.customer_message,
                autoResponse: email.auto_response
            }));
        }
        
        /**
         * Convert relative time to timestamp (approximate for demo)
         */
        function getTimestampFromRelative(relative) {
            const now = new Date();
            const parts = relative.toLowerCase().match(/(\d+)\s*(minute|hour|min|hr)/);
            if (parts) {
                const value = parseInt(parts[1]);
                const unit = parts[2];
                if (unit.includes('hour') || unit === 'hr') {
                    now.setHours(now.getHours() - value);
                } else {
                    now.setMinutes(now.getMinutes() - value);
                }
            }
            return now.toISOString().slice(0, 19).replace('T', ' ');
        }
        
        /**
         * Update statistics display
         */
        function updateStatistics(stats) {
            document.getElementById('statTotal').textContent = stats.totalEmails || stats.total_emails_today || 0;
            document.getElementById('statResponded').textContent = stats.autoResponded || stats.auto_responded || 0;
            document.getElementById('statAvgTime').textContent = stats.avgResponseTime || stats.avg_response_time || '--';
            
            const total = stats.totalEmails || stats.total_emails_today || 0;
            const responded = stats.autoResponded || stats.auto_responded || 0;
            const successRate = total > 0 ? Math.round((responded / total) * 100) : (stats.successRate || stats.success_rate || 0);
            document.getElementById('statSuccessRate').textContent = successRate + '%';
        }
        
        /**
         * Display emails in the feed
         */
        function displayEmails(emails) {
            const feed = document.getElementById('emailFeed');
            
            if (!emails || emails.length === 0) {
                feed.innerHTML = '<div style="text-align: center; padding: var(--space-32); color: var(--color-text-secondary);">No emails yet. Waiting for incoming messages...</div>';
                return;
            }
            
            feed.innerHTML = '';
            
            emails.forEach((email) => {
                const categoryClass = (email.inquiryType || email.category || 'general').toLowerCase();
                const card = document.createElement('div');
                card.className = `email-card ${categoryClass}`;
                card.onclick = () => openEmailModal(email);
                
                const relativeTime = getRelativeTime(email.timestamp);
                
                card.innerHTML = `
                    <div class="email-header">
                        <div class="email-timestamp">${relativeTime}</div>
                    </div>
                    <div class="email-from">${email.from}</div>
                    <div class="email-subject">${email.subject}</div>
                    <div class="email-footer">
                        <span class="category-badge ${categoryClass}">${email.inquiryType || email.category}</span>
                        <span class="status-text">‚úì ${email.status || 'Auto-Responded'}</span>
                        <span class="response-time">${email.responseTime || email.response_time}</span>
                    </div>
                `;
                
                feed.appendChild(card);
            });
            
            updateLastRefreshTime();
        }
        
        /**
         * Convert timestamp to relative time ("2 minutes ago")
         */
        function getRelativeTime(timestamp) {
            if (!timestamp) return 'Unknown';
            
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffSecs = Math.floor(diffMs / 1000);
            const diffMins = Math.floor(diffSecs / 60);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffSecs < 30) return 'Just now';
            if (diffMins < 1) return `${diffSecs} seconds ago`;
            if (diffMins === 1) return '1 minute ago';
            if (diffMins < 60) return `${diffMins} minutes ago`;
            if (diffHours === 1) return '1 hour ago';
            if (diffHours < 24) return `${diffHours} hours ago`;
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            return date.toLocaleDateString();
        }
        
        /**
         * Update last refresh timestamp
         */
        function updateLastRefreshTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('lastRefresh').textContent = `Last updated: ${timeString}`;
            lastRefreshTime = now;
        }
        
        /**
         * Show error message
         */
        function showError(message) {
            const banner = document.getElementById('errorBanner');
            const messageEl = document.getElementById('errorMessage');
            messageEl.textContent = `‚ùå ${message}`;
            banner.style.display = 'block';
        }
        
        /**
         * Hide error message
         */
        function hideError() {
            document.getElementById('errorBanner').style.display = 'none';
        }
        
        /**
         * Show loading state
         */
        function showLoading() {
            isLoading = true;
            document.getElementById('loadingIndicator').style.display = 'block';
            const refreshBtn = document.getElementById('refreshBtn');
            refreshBtn.classList.add('refreshing');
        }
        
        /**
         * Hide loading state
         */
        function hideLoading() {
            isLoading = false;
            document.getElementById('loadingIndicator').style.display = 'none';
            const refreshBtn = document.getElementById('refreshBtn');
            refreshBtn.classList.remove('refreshing');
        }
        
        /**
         * Initial data load
         */
        async function loadData() {
            showLoading();
            await Promise.all([fetchStatistics(), fetchEmails()]);
            hideLoading();
        }
        
        /**
         * Manual refresh triggered by user
         */
        async function manualRefresh() {
            if (isLoading) return;
            await loadData();
        }
        
        /**
         * Retry fetch after error
         */
        async function retryFetch() {
            hideError();
            await loadData();
        }
        
        /**
         * Auto-refresh every 60 seconds
         */
        setInterval(() => {
            if (!isLoading) {
                console.log('Auto-refreshing data...');
                fetchStatistics();
                fetchEmails();
            }
        }, 60000); // 60 seconds
        
        // ============================
        // üîµ UI FUNCTIONS
        // ============================
        
        // Render email feed (legacy - replaced by displayEmails)
        function renderEmailFeed() {
            const feed = document.getElementById('emailFeed');
            feed.innerHTML = '';
            
            emailData.forEach((email, index) => {
                const categoryClass = email.category.toLowerCase();
                const card = document.createElement('div');
                card.className = `email-card ${categoryClass}`;
                card.onclick = () => openEmailModal(email);
                
                card.innerHTML = `
                    <div class="email-header">
                        <div class="email-timestamp">${email.timestamp}</div>
                    </div>
                    <div class="email-from">${email.from}</div>
                    <div class="email-subject">${email.subject}</div>
                    <div class="email-footer">
                        <span class="category-badge ${categoryClass}">${email.category}</span>
                        <span class="status-text">‚úì Auto-Responded</span>
                        <span class="response-time">${email.response_time}</span>
                    </div>
                `;
                
                feed.appendChild(card);
            });
        }

        // Store current email for follow-up
        let currentEmailForFollowUp = null;

        // Modal functions
        function openEmailModal(email) {
            const modal = document.getElementById('emailModal');
            const modalBody = document.getElementById('modalBody');
            const categoryClass = (email.inquiryType || email.category || 'general').toLowerCase();
            const relativeTime = getRelativeTime(email.timestamp);
            const responseTime = email.responseTime || email.response_time || 'Unknown';
            const customerMsg = email.customerMessage || email.customer_message || 'No message available';
            const autoResp = email.autoResponse || email.auto_response || 'No response available';
            
            // Store email for follow-up
            currentEmailForFollowUp = email;
            
            modalBody.innerHTML = `
                <div class="modal-meta">
                    <div class="meta-item">
                        <div class="meta-label">From</div>
                        <div class="meta-value">${email.from}</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Timestamp</div>
                        <div class="meta-value">${relativeTime}</div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Category</div>
                        <div class="meta-value">
                            <span class="category-badge ${categoryClass}">${email.inquiryType || email.category}</span>
                        </div>
                    </div>
                    <div class="meta-item">
                        <div class="meta-label">Response Time</div>
                        <div class="meta-value">${responseTime}</div>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h3>üì¨ Customer Email</h3>
                    <div class="message-box">
                        <p><strong>Subject:</strong> ${email.subject}</p>
                        <p style="margin-top: 12px;">${customerMsg}</p>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h3>ü§ñ Auto-Generated Response</h3>
                    <div class="message-box">
                        <p>${autoResp}</p>
                    </div>
                </div>
                
                <button class="followup-btn" onclick="openFollowUpForm()">
                    ‚úâÔ∏è Send Follow-up
                </button>
            `;
            
            modal.classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('emailModal').classList.remove('active');
        }
        
        // Close modal on outside click
        document.getElementById('emailModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // ============================
        // üîµ THEME TOGGLE FUNCTIONS
        // ============================
        
        /**
         * Initialize theme on page load
         */
        function initTheme() {
            // Set default theme to dark
            applyTheme('dark');
        }
        
        /**
         * Toggle between light and dark theme
         */
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(currentTheme);
        }
        
        /**
         * Apply theme to document
         */
        function applyTheme(theme) {
            currentTheme = theme;
            document.documentElement.setAttribute('data-theme', theme);
            
            // Update toggle button
            const themeIcon = document.getElementById('themeIcon');
            const themeText = document.getElementById('themeText');
            
            if (theme === 'dark') {
                themeIcon.textContent = 'üåô';
                themeText.textContent = 'Dark';
            } else {
                themeIcon.textContent = '‚òÄÔ∏è';
                themeText.textContent = 'Light';
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize theme (default to dark)
            initTheme();
            
            // Show setup banner if backend not configured
            if (!isBackendConfigured) {
                document.getElementById('setupBanner').style.display = 'block';
                console.warn('‚ö†Ô∏è Backend not configured. Using demo data.');
                console.info('üìù To connect to Google Apps Script, update SCRIPT_URL in the JavaScript code.');
            }
            
            // Initial data load
            await loadData();
        });

        // ============================
        // üîµ FOLLOW-UP EMAIL FUNCTIONS
        // ============================
        
        /**
         * Open follow-up email form
         */
        function openFollowUpForm() {
            if (!currentEmailForFollowUp) {
                showNotification('No email selected', 'error');
                return;
            }
            
            const followupModal = document.getElementById('followupModal');
            const toField = document.getElementById('followupTo');
            const subjectField = document.getElementById('followupSubject');
            const messageField = document.getElementById('followupMessage');
            
            // Pre-fill form
            toField.value = currentEmailForFollowUp.from;
            subjectField.value = 'Re: ' + currentEmailForFollowUp.subject;
            messageField.value = '';
            
            // Reset button state
            const sendBtn = document.getElementById('sendFollowUpBtn');
            sendBtn.textContent = 'Send Email';
            sendBtn.disabled = false;
            
            followupModal.classList.add('active');
        }
        
        /**
         * Close follow-up email form
         */
        function closeFollowUpForm() {
            const followupModal = document.getElementById('followupModal');
            followupModal.classList.remove('active');
            
            // Clear form
            document.getElementById('followupForm').reset();
        }
        
        /**
         * Handle follow-up form submission
         */
        async function handleFollowUpSubmit(event) {
            event.preventDefault();
            
            const sendBtn = document.getElementById('sendFollowUpBtn');
            const recipient = document.getElementById('followupTo').value;
            const subject = document.getElementById('followupSubject').value.trim();
            const message = document.getElementById('followupMessage').value.trim();
            
            // Validation
            if (!recipient || !subject || !message) {
                showNotification('Please fill in all fields', 'error');
                return;
            }
            
            if (message.length < 10) {
                showNotification('Message is too short (minimum 10 characters)', 'error');
                return;
            }
            
            // Show loading state
            sendBtn.textContent = 'Sending...';
            sendBtn.disabled = true;
            
            try {
                // Send follow-up email
                const result = await sendFollowUpEmail(recipient, subject, message);
                
                if (result.success) {
                    showNotification('‚úì Follow-up email sent successfully!', 'success');
                    closeFollowUpForm();
                    // Optionally close the email detail modal too
                    // closeModal();
                } else {
                    throw new Error(result.error || 'Failed to send email');
                }
            } catch (error) {
                console.error('Error sending follow-up:', error);
                showNotification('‚úó Failed to send email. ' + error.message, 'error');
                sendBtn.textContent = 'Send Email';
                sendBtn.disabled = false;
            }
        }
        
        /**
         * Send follow-up email via Google Apps Script backend
         */
        async function sendFollowUpEmail(recipient, subject, message) {
            // If backend is not configured, show demo success
            if (!isBackendConfigured) {
                console.log('Demo mode: Would send follow-up email to:', recipient);
                console.log('Subject:', subject);
                console.log('Message:', message);
                
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                return {
                    success: true,
                    message: 'Email sent successfully (demo mode)'
                };
            }
            
            try {
                const formData = new FormData();
                formData.append('action', 'sendFollowUp');
                formData.append('recipient', recipient);
                formData.append('subject', subject);
                formData.append('message', message);
                
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('API error:', error);
                throw error;
            }
        }
        
        /**
         * Show notification message
         */
        function showNotification(message, type = 'success') {
            // Remove any existing notifications
            const existing = document.querySelector('.notification');
            if (existing) {
                existing.remove();
            }
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 4 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }
        
        // Close follow-up modal on outside click
        document.getElementById('followupModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeFollowUpForm();
            }
        });
        
        // Close modal on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
                closeFollowUpForm();
            }
        });
    </script>
</body>
</html>
